<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduGestor - Sistema Acad√™mico</title>
    <style>
        /* CSS COMPLETO E ORIGINAL - NENHUMA ALTERA√á√ÉO FEITA AQUI */
        :root {
            --primary: #3498db; --primary-dark: #2980b9; --secondary: #2ecc71; --secondary-dark: #27ae60;
            --danger: #e74c3c; --danger-dark: #c0392b; --warning: #f39c12; --light: #f8f9fa;
            --dark: #343a40; --gray: #6c757d; --border: #dee2e6;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f5f7fa; color: var(--dark); line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }
        header { background-color: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo h1 { font-size: 1.5rem; color: var(--primary); }
        .logo-icon { font-size: 1.8rem; color: var(--primary); }
        .nav-links { display: flex; gap: 20px; }
        .nav-link { text-decoration: none; color: var(--dark); font-weight: 500; padding: 8px 15px; border-radius: 5px; transition: all 0.3s; cursor: pointer; }
        .nav-link:hover, .nav-link.active { background-color: var(--primary); color: white; }
        .main-content { padding: 30px 0; }
        .page-content { display: none; }
        .page-content.active { display: block; }
        .page-title { margin-bottom: 25px; color: var(--dark); display: flex; align-items: center; gap: 10px; }
        .page-title i { color: var(--primary); }
        .card { background-color: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); padding: 20px; margin-bottom: 25px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
        .card-title { font-size: 1.25rem; font-weight: 600; color: var(--dark); }
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: 500; transition: all 0.3s; display: inline-flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover { background-color: var(--primary-dark); }
        .btn-outline { background-color: transparent; border: 1px solid var(--gray); color: var(--gray); }
        .btn-outline:hover { background-color: var(--gray); color: white; }
        .btn:disabled { background-color: #bdc3c7; border-color: #bdc3c7; color: #7f8c8d; cursor: not-allowed; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-control { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 5px; font-size: 1rem; }
        .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2); }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border); }
        .table th { background-color: #f8f9fa; font-weight: 600; }
        .table tr:hover { background-color: #f8f9fa; }
        .actions { display: flex; gap: 5px; }
        .action-btn { background: none; border: none; cursor: pointer; color: var(--gray); font-size: 1rem; transition: color 0.3s; padding: 5px; }
        .action-btn.edit:hover { color: var(--primary); }
        .action-btn.delete:hover { color: var(--danger); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background-color: white; border-radius: 8px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; display: flex; flex-direction: column; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid var(--border); }
        .modal-title { font-size: 1.25rem; font-weight: 600; }
        .close-modal { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray); }
        .modal-body { padding: 20px; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 10px; padding: 15px 20px; border-top: 1px solid var(--border); }
        .alert { padding: 12px 15px; border-radius: 5px; margin-bottom: 15px; border: 1px solid transparent; }
        .alert-success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .alert-error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 2000; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary); font-size: 1.2rem; transition: opacity 0.3s; }
        .loading-overlay.hidden { opacity: 0; pointer-events: none; }
        .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .dashboard-card { background-color: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); padding: 20px; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .dashboard-card-icon { font-size: 2.5rem; margin-bottom: 15px; color: var(--primary); }
        .dashboard-card-value { font-size: 2rem; font-weight: 700; margin-bottom: 5px; }
        .dashboard-card-label { color: var(--gray); font-size: 0.9rem; }
    </style>
</head>
<body>
    <div id="loading-overlay" class="loading-overlay">
        <span>Carregando sistema...</span>
    </div>

    <header>
        <div class="container">
            <nav class="navbar">
                <div class="logo">
                    <i class="logo-icon">üìö</i>
                    <h1>EduGestor</h1>
                </div>
                <div class="nav-links">
                    <a class="nav-link" data-page="dashboard">Dashboard</a>
                    <a class="nav-link" data-page="turmas">Turmas</a>
                    <a class="nav-link" data-page="professores">Professores</a>
                    <a class="nav-link" data-page="disciplinas">Disciplinas</a>
                    <a class="nav-link" data-page="protagonistas">Protagonistas</a>
                </div>
            </nav>
        </div>
    </header>
    
    <main class="main-content">
        <div class="container">
            <!-- Dashboard -->
            <div id="dashboard" class="page-content">
                <h2 class="page-title"><i>üìä</i> Dashboard</h2>
                <div class="dashboard-cards">
                    <div class="dashboard-card"><div class="dashboard-card-icon">üè´</div><div class="dashboard-card-value" id="total-turmas">0</div><div class="dashboard-card-label">Turmas</div></div>
                    <div class="dashboard-card"><div class="dashboard-card-icon">üë®‚Äçüè´</div><div class="dashboard-card-value" id="total-professores">0</div><div class="dashboard-card-label">Professores</div></div>
                    <div class="dashboard-card"><div class="dashboard-card-icon">üìù</div><div class="dashboard-card-value" id="total-disciplinas">0</div><div class="dashboard-card-label">Disciplinas</div></div>
                    <div class="dashboard-card"><div class="dashboard-card-icon">üë®‚Äçüéì</div><div class="dashboard-card-value" id="total-protagonistas">0</div><div class="dashboard-card-label">Protagonistas</div></div>
                </div>
            </div>
            
            <!-- Turmas -->
            <div id="turmas" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Gerenciar Turmas</h3>
                        <button class="btn btn-primary" data-modal-target="modal-turma"><i>‚ûï</i> Nova Turma</button>
                    </div>
                    <div id="alert-turmas"></div>
                    <table class="table">
                        <thead><tr><th>Nome</th><th>Ano</th><th>Turno</th><th>A√ß√µes</th></tr></thead>
                        <tbody id="turmas-list"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Professores -->
            <div id="professores" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Gerenciar Professores</h3>
                        <button class="btn btn-primary" data-modal-target="modal-professor"><i>‚ûï</i> Novo Professor</button>
                    </div>
                    <div id="alert-professores"></div>
                    <table class="table">
                        <thead><tr><th>Nome</th><th>Email</th><th>A√ß√µes</th></tr></thead>
                        <tbody id="professores-list"></tbody>
                    </table>
                </div>
            </div>

            <!-- Outras se√ß√µes (a serem implementadas) -->
            <div id="disciplinas" class="page-content"><h2 class="page-title"><i>üìù</i> Gerenciar Disciplinas (em breve)</h2></div>
            <div id="protagonistas" class="page-content"><h2 class="page-title"><i>üë®‚Äçüéì</i> Gerenciar Protagonistas (em breve)</h2></div>
        </div>
    </main>
    
    <!-- Modal para Turma -->
    <div class="modal" id="modal-turma">
        <div class="modal-content">
            <form id="form-turma" data-tipo="Turma">
                <div class="modal-header"><h3 class="modal-title">Nova Turma</h3><button type="button" class="close-modal">&times;</button></div>
                <div class="modal-body">
                    <div class="form-group"><label class="form-label" for="turma-nome">Nome da Turma</label><input type="text" class="form-control" id="turma-nome" name="nome" required></div>
                    <div class="form-group"><label class="form-label" for="turma-ano">Ano</label><input type="number" class="form-control" id="turma-ano" name="ano" min="2020" max="2030" required></div>
                    <div class="form-group"><label class="form-label" for="turma-turno">Turno</label><select class="form-control" id="turma-turno" name="turno" required><option value="">Selecione</option><option>Integral</option><option>Manh√£</option><option>Tarde</option><option>Noite</option></select></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-outline close-modal">Cancelar</button><button type="submit" class="btn btn-primary"><span class="btn-text">Salvar</span></button></div>
            </form>
        </div>
    </div>

    <!-- Modal para Professor -->
    <div class="modal" id="modal-professor">
        <div class="modal-content">
            <form id="form-professor" data-tipo="Professor">
                <div class="modal-header"><h3 class="modal-title">Novo Professor</h3><button type="button" class="close-modal">&times;</button></div>
                <div class="modal-body">
                    <div class="form-group"><label class="form-label" for="professor-nome">Nome Completo</label><input type="text" class="form-control" id="professor-nome" name="nome" required></div>
                    <div class="form-group"><label class="form-label" for="professor-email">Email</label><input type="email" class="form-control" id="professor-email" name="email" required></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-outline close-modal">Cancelar</button><button type="submit" class="btn btn-primary"><span class="btn-text">Salvar</span></button></div>
            </form>
        </div>
    </div>

    <script>
        // =================================================================================
        // JAVASCRIPT CORRIGIDO E FUNCIONAL
        // =================================================================================

        // --- CONFIGURA√á√ÉO ---
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx5oBiCJr5d2amsOchim8jhykYG1cjmdD4sCJr-HBpzF5y-c9sFF0gs2nB65zbbmA_4/exec';

        // Dados em mem√≥ria (cache)
        let dados = {
            professores: [],
            turmas: [],
            protagonistas: [],
            disciplinas: [],
            notas: []
        };

        // Elementos da interface
        const UI = {
            loadingOverlay: document.getElementById('loading-overlay'),
            navLinks: document.querySelectorAll('.nav-link'),
            pageContents: document.querySelectorAll('.page-content'),
            modals: document.querySelectorAll('.modal'),
            closeModalButtons: document.querySelectorAll('.close-modal')
        };

        // Fun√ß√£o para comunica√ß√£o com Google Apps Script
        async function chamarGoogleScript(acao, dados = {}) {
            try {
                console.log(`Enviando requisi√ß√£o: ${acao}`, dados);
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: acao,
                        dados: dados
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const textoResposta = await response.text();
                const resultado = JSON.parse(textoResposta);
                
                console.log(`Resposta recebida: ${acao}`, resultado);
                
                return resultado;
            } catch (error) {
                console.error('Erro ao chamar Google Script:', error);
                mostrarAlerta('error', `Erro de conex√£o: ${error.message}`);
                return { success: false, error: error.message };
            }
        }

        // Fun√ß√£o para testar conex√£o
        async function testarConexao() {
            const resultado = await chamarGoogleScript('testarConexao');
            if (resultado.success) {
                mostrarAlerta('success', 'Conex√£o com Google Sheets estabelecida com sucesso!');
            } else {
                mostrarAlerta('error', `Falha na conex√£o: ${resultado.error}`);
            }
            return resultado;
        }

        // Fun√ß√£o para carregar todos os dados
        async function carregarTodosDados() {
            try {
                console.log('Carregando todos os dados...');
                
                const [turmasResult, professoresResult, protagonistasResult, disciplinasResult, notasResult] = await Promise.all([
                    chamarGoogleScript('buscarDados', { tipo: 'Turma' }),
                    chamarGoogleScript('buscarDados', { tipo: 'Professor' }),
                    chamarGoogleScript('buscarDados', { tipo: 'Protagonista' }),
                    chamarGoogleScript('buscarDados', { tipo: 'Disciplina' }),
                    chamarGoogleScript('buscarDados', { tipo: 'Nota' })
                ]);
                
                if (turmasResult.success) {
                    dados.turmas = turmasResult.dados;
                    console.log(`Turmas carregadas: ${dados.turmas.length}`);
                }
                
                if (professoresResult.success) {
                    dados.professores = professoresResult.dados;
                    console.log(`Professores carregados: ${dados.professores.length}`);
                }
                
                if (protagonistasResult.success) {
                    dados.protagonistas = protagonistasResult.dados;
                    console.log(`Protagonistas carregados: ${dados.protagonistas.length}`);
                }
                
                if (disciplinasResult.success) {
                    dados.disciplinas = disciplinasResult.dados;
                    console.log(`Disciplinas carregadas: ${dados.disciplinas.length}`);
                }
                
                if (notasResult.success) {
                    dados.notas = notasResult.dados;
                    console.log(`Notas carregadas: ${dados.notas.length}`);
                }
                
                return true;
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                mostrarAlerta('error', 'Erro ao carregar dados do servidor');
                return false;
            }
        }

        // Fun√ß√£o para carregar turmas
        async function carregarTurmas() {
            mostrarLoading('turmas-list', 'Carregando turmas...');
            
            try {
                const tbody = document.getElementById('turmas-list');
                tbody.innerHTML = '';
                
                if (dados.turmas.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Nenhuma turma cadastrada</td></tr>';
                    return;
                }
                
                dados.turmas.forEach(turma => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${turma.nome || 'N/A'}</td>
                        <td>${turma.ano || 'N/A'}</td>
                        <td>${turma.turno || 'N/A'}</td>
                        <td class="actions">
                            <button class="action-btn edit" data-id="${turma.id}" title="Editar">
                                <i>‚úèÔ∏è</i>
                            </button>
                            <button class="action-btn delete" data-id="${turma.id}" title="Excluir">
                                <i>üóëÔ∏è</i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                
                // Adicionar eventos aos bot√µes de a√ß√£o
                adicionarEventosAcaoTurmas();
                
            } catch (error) {
                console.error('Erro ao carregar turmas:', error);
                mostrarAlerta('error', 'Erro ao carregar turmas', 'alert-turmas');
            }
        }

        // Fun√ß√£o para carregar professores
        async function carregarProfessores() {
            mostrarLoading('professores-list', 'Carregando professores...');
            
            try {
                const tbody = document.getElementById('professores-list');
                tbody.innerHTML = '';
                
                if (dados.professores.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align: center;">Nenhum professor cadastrado</td></tr>';
                    return;
                }
                
                dados.professores.forEach(professor => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${professor.nome || 'N/A'}</td>
                        <td>${professor.email || 'N/A'}</td>
                        <td class="actions">
                            <button class="action-btn edit" data-id="${professor.id}" title="Editar">
                                <i>‚úèÔ∏è</i>
                            </button>
                            <button class="action-btn delete" data-id="${professor.id}" title="Excluir">
                                <i>üóëÔ∏è</i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                
                // Adicionar eventos aos bot√µes de a√ß√£o
                adicionarEventosAcaoProfessores();
                
            } catch (error) {
                console.error('Erro ao carregar professores:', error);
                mostrarAlerta('error', 'Erro ao carregar professores', 'alert-professores');
            }
        }

        // Fun√ß√£o para salvar item (turma ou professor)
        async function salvarItem(e) {
            e.preventDefault();
            const form = e.target;
            const btn = form.querySelector('button[type="submit"]');
            const btnText = btn.querySelector('.btn-text');
            const tipo = form.dataset.tipo;
            
            try {
                btn.disabled = true;
                btnText.textContent = 'Salvando...';
                
                const formData = new FormData(form);
                const dadosItem = Object.fromEntries(formData.entries());
                dadosItem.tipo = tipo;
                
                let resultado;
                if (form.dataset.id) {
                    dadosItem.id = parseInt(form.dataset.id);
                    resultado = await chamarGoogleScript('atualizarDados', dadosItem);
                } else {
                    resultado = await chamarGoogleScript('salvarDados', dadosItem);
                }
                
                if (resultado.success) {
                    mostrarAlerta('success', 
                        form.dataset.id ? `${tipo} atualizado com sucesso!` : `${tipo} criado com sucesso!`, 
                        `alert-${tipo.toLowerCase()}s`);
                    
                    fecharModal(form.closest('.modal').id);
                    
                    // Recarregar dados e atualizar interface
                    await carregarTodosDados();
                    if (tipo === 'Turma') {
                        await carregarTurmas();
                    } else if (tipo === 'Professor') {
                        await carregarProfessores();
                    }
                    atualizarDashboard();
                } else {
                    mostrarAlerta('error', `Erro ao salvar ${tipo}: ${resultado.error}`, `alert-${tipo.toLowerCase()}s`);
                }
            } catch (error) {
                console.error(`Erro ao salvar ${tipo}:`, error);
                mostrarAlerta('error', `Erro ao salvar ${tipo}`, `alert-${tipo.toLowerCase()}s`);
            } finally {
                btn.disabled = false;
                btnText.textContent = 'Salvar';
            }
        }

        // Fun√ß√£o para editar item
        async function editarItem(id, tipo) {
            try {
                const item = dados[tipo.toLowerCase() + 's'].find(t => t.id == id);
                if (item) {
                    const modalId = `modal-${tipo.toLowerCase()}`;
                    const modal = document.getElementById(modalId);
                    const form = modal.querySelector('form');
                    const titulo = modal.querySelector('.modal-title');
                    
                    titulo.textContent = `Editar ${tipo}`;
                    form.dataset.id = id;
                    
                    // Preencher formul√°rio com dados existentes
                    for (const key in item) {
                        const input = form.querySelector(`[name="${key}"]`);
                        if (input) input.value = item[key];
                    }
                    
                    modal.classList.add('active');
                }
            } catch (error) {
                console.error(`Erro ao editar ${tipo}:`, error);
                mostrarAlerta('error', `Erro ao carregar dados do ${tipo}`, `alert-${tipo.toLowerCase()}s`);
            }
        }

        // Fun√ß√£o para excluir item
        async function excluirItem(id, tipo) {
            try {
                if (confirm(`Tem certeza que deseja excluir este ${tipo.toLowerCase()}?`)) {
                    const resultado = await chamarGoogleScript('excluirDados', { id: parseInt(id) });
                    
                    if (resultado.success) {
                        mostrarAlerta('success', `${tipo} exclu√≠do com sucesso!`, `alert-${tipo.toLowerCase()}s`);
                        await carregarTodosDados();
                        
                        if (tipo === 'Turma') {
                            await carregarTurmas();
                        } else if (tipo === 'Professor') {
                            await carregarProfessores();
                        }
                        atualizarDashboard();
                    } else {
                        mostrarAlerta('error', `Erro ao excluir ${tipo}: ${resultado.error}`, `alert-${tipo.toLowerCase()}s`);
                    }
                }
            } catch (error) {
                console.error(`Erro ao excluir ${tipo}:`, error);
                mostrarAlerta('error', `Erro ao excluir ${tipo}`, `alert-${tipo.toLowerCase()}s`);
            }
        }

        // Adicionar eventos de a√ß√£o para turmas
        function adicionarEventosAcaoTurmas() {
            document.querySelectorAll('#turmas-list .action-btn.edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    editarItem(id, 'Turma');
                });
            });
            
            document.querySelectorAll('#turmas-list .action-btn.delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    excluirItem(id, 'Turma');
                });
            });
        }

        // Adicionar eventos de a√ß√£o para professores
        function adicionarEventosAcaoProfessores() {
            document.querySelectorAll('#professores-list .action-btn.edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    editarItem(id, 'Professor');
                });
            });
            
            document.querySelectorAll('#professores-list .action-btn.delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    excluirItem(id, 'Professor');
                });
            });
        }

        // Fun√ß√µes auxiliares
        function mostrarAlerta(tipo, mensagem, elementoId = null) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${tipo}`;
            alertDiv.textContent = mensagem;
            
            if (elementoId) {
                const container = document.getElementById(elementoId);
                if (container) {
                    container.innerHTML = '';
                    container.appendChild(alertDiv);
                }
            } else {
                // Mostrar no topo da p√°gina se n√£o especificado
                const mainContent = document.querySelector('.main-content');
                if (mainContent) {
                    mainContent.insertBefore(alertDiv, mainContent.firstChild);
                }
            }
            
            // Auto-remover ap√≥s 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
        }

        function mostrarLoading(elementoId, mensagem = 'Carregando...') {
            const elemento = document.getElementById(elementoId);
            if (elemento) {
                elemento.innerHTML = `<tr><td colspan="4" style="text-align: center;">${mensagem}</td></tr>`;
            }
        }

        function atualizarDashboard() {
            const totalTurmas = document.getElementById('total-turmas');
            const totalProfessores = document.getElementById('total-professores');
            const totalDisciplinas = document.getElementById('total-disciplinas');
            const totalProtagonistas = document.getElementById('total-protagonistas');
            
            if (totalTurmas) totalTurmas.textContent = dados.turmas.length;
            if (totalProfessores) totalProfessores.textContent = dados.professores.length;
            if (totalDisciplinas) totalDisciplinas.textContent = dados.disciplinas.length;
            if (totalProtagonistas) totalProtagonistas.textContent = dados.protagonistas.length;
        }

        function abrirModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                const form = modal.querySelector('form');
                form.reset();
                form.removeAttribute('data-id');
                modal.querySelector('.modal-title').textContent = `Novo ${form.dataset.tipo}`;
                modal.classList.add('active');
            }
        }

        function fecharModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }

        function navegarPara(page) {
            // Atualizar navega√ß√£o
            UI.navLinks.forEach(l => l.classList.remove('active'));
            const activeLink = Array.from(UI.navLinks).find(l => l.dataset.page === page);
            if (activeLink) activeLink.classList.add('active');
            
            // Atualizar conte√∫do
            UI.pageContents.forEach(c => c.classList.remove('active'));
            const activePage = document.getElementById(page);
            if (activePage) activePage.classList.add('active');
            
            // Carregar dados espec√≠ficos da p√°gina
            if (page === 'dashboard') {
                atualizarDashboard();
            } else if (page === 'turmas') {
                carregarTurmas();
            } else if (page === 'professores') {
                carregarProfessores();
            }
        }

        // --- INICIALIZA√á√ÉO E EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Sistema acad√™mico inicializando...');
            
            try {
                // Testar conex√£o primeiro
                const conexao = await testarConexao();
                if (!conexao.success) {
                    UI.loadingOverlay.innerHTML = "Falha na conex√£o. Verifique a URL do Script e o console (F12).";
                    return;
                }
                
                // Carregar dados
                const sucesso = await carregarTodosDados();
                if (sucesso) {
                    // Esconder loading e mostrar dashboard
                    UI.loadingOverlay.classList.add('hidden');
                    navegarPara('dashboard');
                    console.log('Sistema carregado com sucesso');
                } else {
                    UI.loadingOverlay.innerHTML = "Falha ao carregar dados. Verifique o console (F12).";
                }
            } catch (error) {
                console.error('Erro na inicializa√ß√£o:', error);
                UI.loadingOverlay.innerHTML = "Erro cr√≠tico na inicializa√ß√£o. Verifique o console (F12).";
            }

            // Navega√ß√£o
            UI.navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navegarPara(e.target.dataset.page);
                });
            });

            // Abrir modais com bot√£o "Novo"
            document.querySelectorAll('[data-modal-target]').forEach(btn => {
                btn.addEventListener('click', () => abrirModal(btn.dataset.modalTarget));
            });

            // Fechar modais
            UI.closeModalButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const modal = btn.closest('.modal');
                    if (modal) fecharModal(modal.id);
                });
            });
            
            UI.modals.forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) fecharModal(modal.id);
                });
            });

            // Submiss√£o de formul√°rios
            document.getElementById('form-turma').addEventListener('submit', salvarItem);
            document.getElementById('form-professor').addEventListener('submit', salvarItem);
        });
    </script>
</body>
</html>
